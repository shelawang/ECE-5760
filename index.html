<!DOCTYPE html>
<!-- saved from url=(0051)http://getbootstrap.com/examples/starter-template/# -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="files/bootstrap.css" rel="stylesheet">
  <script src="files/ie-emulation-modes-warning.js"></script>

  <title>FPGA Command Line Interface | ECE 5760</title>
</head>

<body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#top">Command Line Interface</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="#intro">Introduction</a></li>
        <li><a href="#design">Design</a></li>
        <li><a href="#results">Results</a></li>
        <li><a href="#conclusions">Conclusions</a></li>
        <li><a href="#appendix">Appendix</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">
<div class="starter-template" style="text-align:left;">
<link rel="stylesheet" href="files/bootstrap_002.css">


<h1 id="top" style="text-align:center;">FPGA Command Line Interface and File System</h1>
<h3 style="text-align:center;">ECE 5760 Final Project, Spring 2015</h3>
<h4 style="text-align:center;">Victor Fei (vf63), Shela Wang (sw679), and Richard Quan (rq32)</h4>

<div class="container" id="intro">
<h3>Introduction</h3>
<p>Our project connects a VGA monitor and a keyboard to an FPGA via an Altera DE2 development board to create a system resembling a personal computer. By simulating a traditional command line interface (CLI) on the VGA screen, users can perform certain operations through the CLI. Additionally, we utilized the DE2 board's built-in SD card reader to allow users to import, manipulate, and save portable data, effectively creating a simplified file system for the FPGA.</p>
<figure>
<img src="files/screen.JPG" alt="Photograph of the system" align="middle" width="500">
<figcaption>A photograph of the system.</figcaption>
</figure>

<p>The project uses the Pancake stack CPU to handle the high-level computations and tasks. Thus, one of the results of our work on this project was several new functions that can be added to programs written for Pancake. The project also includes some preliminary work interfacing the FPGA with the on-board SD card, without using Nios II or C. We have compiled a list of the new features that we implemented, which we believe may be helpful to future students. This list is found in the <a href="#confeatures">Useful Features</a> section of this page.</p>

</div> <!-- End of Intro div -->

<div class="container" id="design">
<h3>Design</h3>
<small><a href="#desinterface">Block Diagram</a> | <a href="#desconnections">Connections</a> | <a href="#descomm">Communication</a> | <a href="#dessound">Sound</a> | <a href="#desdiff">Difficulties &amp; Choices</a></small> <br>

<br/><h4 id="desinterface">Block Diagram</h4>
<p>The figure below illustrates the major components of the system. The hardware interface consists of an FPGA on the DE2 board with an SD card reader connected to a PS/2 keyboard and a VGA monitor. We use a Pancake processor running on the FPGA to interface between the software (Syrup) and hardware (Verilog) components of our design. The FPGA accepts user input via the keyboard, interprets and processes the command through Pancake, and outputs the I/O through a command line interface (CLI) displayed on the VGA, in a way reminiscent of personal computers of yore.  The SD card reader sends and receives data in the same fashion.</p>
<figure>
<img src="files/block_diagram.png" alt="block diagram" width="700">
<figcaption>Block diagram of the system</figcaption>
</figure>

<br/><h4 id="desconnections">Connections</h4>
<p></p>

<br/><h4 id="descomm">Communication</h4>
<p>TODO: talk about things like PS/2, VGA, etc.</p>

<hr>
<br/><h4 id="dessoftware">Software</h4>
<p>
  When we started this project. The Pancake programming language came with very
  few functions. Consequently, part of our project is to extend the Pancake
  programming language library and to add many basic functions that should belong to a
  programming language. Our hope was to make the Pancake programming language friendlier
  to other users.
  The functions that we could be useful to the Pancake library include:
  <ul>
    <li><i>itoa</i>: printing number to vga in decimal format</li>
    <li><i>mod</i>: modular operation</li>
    <li><i>div</i>: integer division</li>
    <li><i>power</i>: exponentiation operation</li>
    <li><i>bubble_sort</i>: perform bubble sort on an array</li>
    <li><i>print_array</i>: printing an array to vga</li>
    <li><i>max</i>: return the max of an array</li>
    <li><i>min</i>: return the min of an array</li>
    <li><i>reverse</i>: reverse an array</li>
  </ul>

  <b>itoa</b>: <i>printing number to vga in decimal format</i>




</p>

<h5>Accepting User Input</h5>
<p></p>

<h5>Parsing User Input</h5>
<p></p>

<h5>Calculator</h5>
<p></p>

<h5>File System</h5>
<p></p>

<br/><h4 id="deshardware">Hardware</h4>
<p></p>

<h5>Keyboard Controller</h5>
<p></p>

<h5>Keyboard Scan Code Look-up Table</h5>
<p></p> @Richard

<h5>SD Card Controller</h5>
<p></p>

<br/><h4 id="desdiff">Design Difficulties and Choices</h4>
<p></p>

<h5>Minimizing Code Size</h5>
<p></p>

<h5>Minimizing Input/Output Ports</h5>
<p></p> @Shela

<h5>Multiple Key-Presses</h5>
<p></p> @Shela or Richard

</div> <!-- end of Design div -->


<div class="container" id="results">
<h3>Results</h3>
<small><a href="#resspeed">Speed/Accuracy</a> | <a href="#ressafety">Safety</a> | <a href="#resusability">Usability</a></small><br>

<br><h4 id="resspeed">Speed and Accuracy</h4>

<h5>Calculations</h5>
<p></p>

<h5>File System</h5>
<p></p>

<br><h4 id="ressafety">Safety</h4>
<p>Our system has no moving parts and consists solely of a DE2 development board, keyboard, VGA monitor, and SD card. These components are fairly familiar to the typical user, and we therefore do not foresee using our system as being any more dangerous than using a regular personal computer.</p>

<br><h4 id="resusability">Usability</h4>
<p>The system is usable and fun to use as a command line interface. For most commands, such as the calculator and array functions, there is no no perceivable delay between when the user enters the command when the response is displayed on the screen.</p>
<p>On the other hand, because of the way that we implemented the file system, most of the file-related commands, such as ls (list files), mk (make new file), and cat (show file contents), can take a second or two to complete.</p>
<p>A feature that would improve the usability of the system would be error messages. For example, if a user tries to show the contents of a file that does not exist, then the system would show on the screen that no such file exists. In the system's current state, the user does not receive any indication when a command or file name is not valid.</p>

</div> <!-- end of Results div -->


<div class="container" id="conclusions">
<h3>Conclusions</h3>
<small><a href="#consuccess">Success</a> | <a href="#confeatures">Features</a> | <a href="#constandards">Standards</a> | <a href="#conconsiderations">Considerations</a> | <a href="#conimprovements">Improvements</a></small><br>

<br><h4 id="consuccess">Success of the Project</h4>
<p>Our project was a success. While we were not able to implement all of the features that we had initially set out to create &mdash; such as a full-fledged interpreter and the ability to run programs directly from the SD card &mdash; our system is usable and has several other fun and useful features. In addition, we believe that future students may find some use in certain features that we implemented. These features are detailed in the <a href="#confeatures">Useful Features</a> section below.</p>

<br><h4 id="confeatures">Useful Features</h4>

<h5>New Pancake functions</h5>
<p>@Victor: Discuss new functions</p>
  <ul> negative numbers
  <li>
  </ul>
<h5>Pancake compilation script</h5>
<p></p> @Shela
TODO talk about how the script works and how to use it

<h5>SD Card controller</h5>
<p></p> @Shela
TODO mention that SD controller only works below 2 GB

<h5>Keyboard scan-code to ASCII look-up table</h5>
<p></p>


<br><h4 id="constandards">Conformity to Standards</h4>
<p></p>

<br><h4 id="conconsiderations">Legal and Ethical Considerations</h4>
<p>In developing this project, we followed the IEEE Code of Ethics, being careful in the development of our project to engineer our product in a responsible manner. We investigated the possible safety concerns that could come along with this project, and determined fully that our project would be safe even if accidents were to occur. We minimized risk in order to be consistent with public safety and welfare in mind.</p>
<p>In addition, we sought honest criticism at every stage of the development of our project, including from Bruce Land, our TA Deepak, and from our classmates to make our project better. At many points, we had small errors in our code or in our design, and we have acknowledged the contributions of all those involved in this project. We have been honest and realistic in the abilities and limitations of our project throughout. This is exemplified by our statements about how the project is limited in its current form, but there is plenty of room for extensibility. We have also been honest with the drawbacks of our project in terms of usability and modularity.</p>
<p>Finally, we have sought to improve understanding of technology through our project. We make all of the information available to the public in order to encourage others to build similar products if they are interested. This project is a good example of how computers were built from the ground up, and we hope that this reaches those who have similar interests and want to build similar systems.</p>

<br><h4 id="conimprovements">Possible Improvements</h4>
<h5>Error Messages</h5>
<p>Having meaningful error messages when a user enters an invalid command would improve the usability of our system. In our current system, if a user enters an invalid command or tries to display the contents of a file that does not exist, then the CLI simply does not output anything. In contrast, if a user enters an invalid command in Linux, for example, the CLI will display a message saying that the command was unsuccessful so that the user knows to try a different command.</p>

<h5>Handling Larger Numbers</h5>
<p></p>
[i.e., calculations with larger numbers] @Victor

<h5>Interpreter</h5>
<p></p> @Victor?

<h5>Efficient SD Card Access</h5>
<p>In the project's current form, a single "write" to the SD card actually writes an entire 512-byte "sector" of the SD card. Thus, the storage capacity on the SD card is reduced by a factor of 512, while the time required to read and write from the card is increased by a factor of 512. Improvements to reading and writing the SD card would greatly enhance the usability of the system, because file reads and writes would be much faster, and users would have the ability to create more files.</p>

<h5>Hierarchical File System</h5>
<p>Customizable file names and the ability to create and navigate between directories would make our file system seem more like that of a regular computer. A real bonus would be to implement FAT32-style reading and writing so that files could even be transfered between the FPGA and other computers with SD card slots.</p>

</div> <!-- end of Conclusions div -->


<div class="container" id="appendix">
<h3>Appendix</h3>
<br><h4>Code</h4>
TODO

<br><h4>Parts List</h4>
<p><ul>
  <li>Altera DE2 Development Board
  <li>VGA Monitor
  <li>PS/2 Keyboard
  <li>32 MB SD Card
</ul></p>
<p>All of the parts used for this project (except for the SD card) were borrowed from Bruce Land's lab.</p>

<br><h4>References</h4>
<p><ul>
<li>PS/2 Keyboard Controller from Skyler Schneider's <a href="http://people.ece.cornell.edu/land/courses/ece5760/FinalProjects/f2010/ss868/ss868/index.html" target="_blank">"Falling Sand Game"</a>, ECE 4750 Fall 2010
<li>Information on the <a href="http://elm-chan.org/docs/mmc/mmc_e.html" target="_blank">SD card communication protocol</a>
<li><a href="http://alumni.cs.ucr.edu/~amitra/sdcard/Additional/sdcard_appnote_foust.pdf" target="_blank">Further information on SD cards</a> by F. Foust at Michigan State University
<li>Information on <a href="http://www.chlazza.net/sdcardinfo.html" target="_blank">SD card responses</a>
<li><a href="http://people.ece.cornell.edu/land/courses/ece5760/DE2/Stack_cpu.html" target="_blank">Pancake Stack CPU</a> on the ECE 5760 webpage
<li><a href="http://mh-nexus.de/en/hxd/" target="_blank">HxD - Freeware Hex and Disk Editor</a> &mdash; a very important tool for making projects with SD cards
<li>SD Card Controller from Theo Engel's <a href="http://www.theoengel.nl/P8/index.html" target="_blank">P856 Minicomputer</a> project
  <ul>
  <li>The Verilog for the SD card controller is in <a href="http://www.theoengel.nl/ddpx16/archive/p800-fpga/p8-01/sd_card3.v" target="_blank">sd_card3.v</a>
  </ul>
</ul></p>

<br><h4>Acknowledgements</h4>
<p>We would like to thank the course instructor, Bruce Land, and the TA Deepak for their help and advice throughout this project.</p>

<figure>
<img src="files/selfie.JPG" alt="Selfie" align="middle" width="500">
</figure>

</div> <!-- end of Appendix div -->




</div><!-- /.container -->

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="files/jquery.htm"></script>
<script src="files/bootstrap.htm"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="files/ie10-viewport-bug-workaround.htm"></script>

</div></body></html>
